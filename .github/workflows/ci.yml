name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  python:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.7', '3.8', '3.9', '3.10']
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements-dev.txt
    - name: Check
      run: pre-commit run --all-files
    - name: Test
      run: make test
    - name: Build Package
      run: make package
    - name: Check Package
      run: make check_dist

  # super-lint:
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: Lint Code Base
  #     uses: docker://github/super-linter:v4.8.5
  #     env:
  #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       VALIDATE_BASH: false  # Already configured in pre-commit
  #       VALIDATE_DOCKERFILE_HADOLINT: false
  #       VALIDATE_PYTHON_FLAKE8: false  # Already configured in pre-commit
  #       VALIDATE_PYTHON_PYLINT: false  # Already configured in pre-commit
  #       VALIDATE_PYTHON_ISORT: false  # Already configured in pre-commit
